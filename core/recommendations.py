"""
–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ —Å —è–≤–Ω—ã–º –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ–º –º—ã—à–ª–µ–Ω–∏—è.
"""


class ReasoningRecommender:
    """–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π —Å –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ–º."""

    @staticmethod
    def get_recommendation(context):
        """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—é —Å –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ–º."""

        # –®–ê–ì 1: –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ
        material = context.material.lower() if context.material else ""
        operation = context.operation.lower() if context.operation else ""
        mode = context.active_mode.lower() if context.active_mode else ""
        diameter = context.diameter

        # –®–ê–ì 2: –§–æ—Ä–º–∏—Ä—É–µ–º –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ
        reasoning = ReasoningRecommender._build_reasoning(material, operation, mode, diameter)

        # –®–ê–ì 3: –î–∞–µ–º —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
        advice = ReasoningRecommender._get_advice(material, operation, mode, diameter)

        # –®–ê–ì 4: –û–±—ä–µ–¥–∏–Ω—è–µ–º
        return f"{reasoning}\n\n{advice}"

    @staticmethod
    def _build_reasoning(material, operation, mode, diameter):
        """–û–±—ä—è—Å–Ω—è–µ—Ç, –ø–æ—á–µ–º—É —Ç–∞–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏."""
        reasoning_parts = []

        reasoning_parts.append("ü§î **–í–æ—Ç –∫–∞–∫ —è –¥—É–º–∞—é:**")

        # –û–±—ä—è—Å–Ω–µ–Ω–∏–µ –ø–æ –º–∞—Ç–µ—Ä–∏–∞–ª—É
        if '–∞–ª—é–º–∏–Ω' in material:
            reasoning_parts.append("‚Ä¢ **–ú–∞—Ç–µ—Ä–∏–∞–ª:** –ê–ª—é–º–∏–Ω–∏–π ‚Äî –º—è–≥–∫–∏–π, —Ö–æ—Ä–æ—à–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è, –ª—é–±–∏—Ç —Å–∫–æ—Ä–æ—Å—Ç—å.")
        elif '—Å—Ç–∞–ª—å' in material:
            reasoning_parts.append("‚Ä¢ **–ú–∞—Ç–µ—Ä–∏–∞–ª:** –°—Ç–∞–ª—å ‚Äî –ø—Ä–æ—á–Ω–µ–µ, —Ç—Ä–µ–±—É–µ—Ç –æ—Ö–ª–∞–∂–¥–µ–Ω–∏—è, —É–º–µ—Ä–µ–Ω–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤.")

        # –û–±—ä—è—Å–Ω–µ–Ω–∏–µ –ø–æ –æ–ø–µ—Ä–∞—Ü–∏–∏
        if '—Ç–æ–∫–∞—Ä' in operation:
            reasoning_parts.append("‚Ä¢ **–û–ø–µ—Ä–∞—Ü–∏—è:** –¢–æ–∫–∞—Ä–Ω–∞—è ‚Äî –≤—Ä–∞—â–µ–Ω–∏–µ –¥–µ—Ç–∞–ª–∏, –ª–∏–Ω–µ–π–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞.")
        elif '—Ñ—Ä–µ–∑' in operation:
            reasoning_parts.append("‚Ä¢ **–û–ø–µ—Ä–∞—Ü–∏—è:** –§—Ä–µ–∑–µ—Ä–Ω–∞—è ‚Äî –≤—Ä–∞—â–µ–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞, —Å–ª–æ–∂–Ω–∞—è —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏—è.")

        # –û–±—ä—è—Å–Ω–µ–Ω–∏–µ –ø–æ —Ä–µ–∂–∏–º—É
        if '—á–µ—Ä–Ω–æ–≤' in mode:
            reasoning_parts.append("‚Ä¢ **–†–µ–∂–∏–º:** –ß–µ—Ä–Ω–æ–≤–∞—è ‚Äî –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Å—ä—ë–º, –º–µ–Ω—å—à–µ —Ç–æ—á–Ω–æ—Å—Ç–∏, –≤—ã—à–µ –Ω–∞–≥—Ä—É–∑–∫–∏.")
        elif '—á–∏—Å—Ç–æ–≤' in mode:
            reasoning_parts.append("‚Ä¢ **–†–µ–∂–∏–º:** –ß–∏—Å—Ç–æ–≤–∞—è ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Å—ä—ë–º, –≤—ã—Å–æ–∫–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å, –∫–∞—á–µ—Å—Ç–≤–æ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏.")

        # –û–±—ä—è—Å–Ω–µ–Ω–∏–µ –ø–æ –¥–∏–∞–º–µ—Ç—Ä—É
        if diameter:
            try:
                dia = float(diameter.replace(',', '.'))
                if dia < 10:
                    reasoning_parts.append(
                        f"‚Ä¢ **–î–∏–∞–º–µ—Ç—Ä {dia} –º–º:** –ú–∞–ª–µ–Ω—å–∫–∏–π ‚Äî –Ω—É–∂–Ω—ã –≤—ã—Å–æ–∫–∏–µ –æ–±–æ—Ä–æ—Ç—ã, –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç—å —Å –≤–∏–±—Ä–∞—Ü–∏—è–º–∏.")
                elif dia > 50:
                    reasoning_parts.append(
                        f"‚Ä¢ **–î–∏–∞–º–µ—Ç—Ä {dia} –º–º:** –ë–æ–ª—å—à–æ–π ‚Äî –≤–Ω–∏–º–∞–Ω–∏–µ –∫ –º–æ—â–Ω–æ—Å—Ç–∏ —Å—Ç–∞–Ω–∫–∞, –±–æ–ª—å—à–∏–µ —É—Å–∏–ª–∏—è —Ä–µ–∑–∞–Ω–∏—è.")
            except:
                pass

        # –ó–∞–∫–ª—é—á–µ–Ω–∏–µ
        reasoning_parts.append("\n**–ò—Å—Ö–æ–¥—è –∏–∑ —ç—Ç–æ–≥–æ:**")

        return "\n".join(reasoning_parts)

    @staticmethod
    def _get_advice(material, operation, mode, diameter):
        """–î–∞–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏."""

        # –ë–∞–∑–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
        if '–∞–ª—é–º–∏–Ω' in material and '—Ç–æ–∫–∞—Ä' in operation:
            if '—á–µ—Ä–Ω–æ–≤' in mode:
                return (
                    "üè≠ **–†–µ–∫–æ–º–µ–Ω–¥—É—é –Ω–∞—á–∞—Ç—å —Å:**\n"
                    "‚Ä¢ **–û–±–æ—Ä–æ—Ç—ã:** 1000-2000 –æ–±/–º–∏–Ω\n"
                    "‚Ä¢ **–ü–æ–¥–∞—á–∞:** 0.3-0.5 –º–º/–æ–±\n"
                    "‚Ä¢ **–ì–ª—É–±–∏–Ω–∞:** 3-5 –º–º\n\n"
                    "üí° **–ü–æ—á–µ–º—É —Ç–∞–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**\n"
                    "‚Ä¢ –ê–ª—é–º–∏–Ω–∏–π –º—è–≥–∫–∏–π ‚Äî –º–æ–∂–Ω–æ –±—Ä–∞—Ç—å –±–æ–ª—å—à—É—é –≥–ª—É–±–∏–Ω—É\n"
                    "‚Ä¢ –í—ã—Å–æ–∫–∏–µ –æ–±–æ—Ä–æ—Ç—ã –¥–∞—é—Ç —Ö–æ—Ä–æ—à—É—é —Å—Ç—Ä—É–∂–∫—É\n"
                    "‚Ä¢ –ë–æ–ª—å—à–∞—è –ø–æ–¥–∞—á–∞ —É—Å–∫–æ—Ä—è–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É"
                )
            elif '—á–∏—Å—Ç–æ–≤' in mode:
                return (
                    "‚ú® **–î–ª—è —á–∏—Å—Ç–æ–≤–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏:**\n"
                    "‚Ä¢ **–û–±–æ—Ä–æ—Ç—ã:** 1500-3000 –æ–±/–º–∏–Ω\n"
                    "‚Ä¢ **–ü–æ–¥–∞—á–∞:** 0.1-0.2 –º–º/–æ–±\n"
                    "‚Ä¢ **–ì–ª—É–±–∏–Ω–∞:** 0.5-1 –º–º\n\n"
                    "üíé **–ß—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –±–ª–µ—Å–∫:**\n"
                    "‚Ä¢ –û—á–µ–Ω—å –æ—Å—Ç—Ä—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω\n"
                    "‚Ä¢ –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –ø–æ–¥–∞—á–∞ –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–º –ø—Ä–æ—Ö–æ–¥–µ\n"
                    "‚Ä¢ –í–æ–∑–¥—É—Ö –≤–º–µ—Å—Ç–æ –°–û–ñ –¥–ª—è —á–∏—Å—Ç–æ—Ç—ã"
                )

        elif '—Å—Ç–∞–ª—å' in material and '—Ç–æ–∫–∞—Ä' in operation:
            if '—á–µ—Ä–Ω–æ–≤' in mode:
                return (
                    "‚öôÔ∏è **–î–ª—è —á–µ—Ä–Ω–æ–≤–æ–π —Ç–æ–∫–∞—Ä–∫–∏ —Å—Ç–∞–ª–∏:**\n"
                    "‚Ä¢ **–°–∫–æ—Ä–æ—Å—Ç—å:** 100-160 –º/–º–∏–Ω\n"
                    "‚Ä¢ **–ü–æ–¥–∞—á–∞:** 0.2-0.35 –º–º/–æ–±\n"
                    "‚Ä¢ **–ì–ª—É–±–∏–Ω–∞:** 2-3 –º–º\n\n"
                    "‚ö†Ô∏è **–í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã:**\n"
                    "‚Ä¢ –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –°–û–ñ\n"
                    "‚Ä¢ –°—Ç—Ä—É–∂–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å–µ–≥–º–µ–Ω—Ç–Ω–æ–π\n"
                    "‚Ä¢ –ü—Ä–∏ –≤–∏–±—Ä–∞—Ü–∏—è—Ö ‚Äî —Å–Ω–∏–∂–∞–π—Ç–µ –ø–æ–¥–∞—á—É"
                )

        # –û–±—â–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
        return (
            "üîß **–°—Ç–∞—Ä—Ç–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**\n"
            "‚Ä¢ –ù–∞—á–Ω–∏—Ç–µ —Å–æ —Å—Ä–µ–¥–Ω–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π –∏–∑ –ø–∞—Å–ø–æ—Ä—Ç–∞\n"
            "‚Ä¢ –°–¥–µ–ª–∞–π—Ç–µ –ø—Ä–æ–±–Ω—ã–π –ø—Ä–æ—Ö–æ–¥\n"
            "‚Ä¢ –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–π—Ç–µ –ø–æ —Å—Ç—Ä—É–∂–∫–µ –∏ –≤–∏–±—Ä–∞—Ü–∏—è–º\n\n"
            "üí≠ **–ó–æ–ª–æ—Ç–æ–µ –ø—Ä–∞–≤–∏–ª–æ:**\n"
            "–•–æ—Ä–æ—à–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ = —Ö–æ—Ä–æ—à–∞—è —Å—Ç—Ä—É–∂–∫–∞"
        )