# ARCHITECTURE.md

## Архитектура Системы «СТАНКО-ИИ» (День 1)

### **Цель дня**
К концу дня бот должен:
✅ выглядеть как ИИ
✅ не зацикливаться на вопросах  
✅ понимать контекст
✅ уметь делать предположения
✅ работать стабильно

❌ Без расчётов
❌ Без LLM
✅ Только логика

### **Поток данных**
1. Telegram сообщение → парсер → контекст → предположения → ответ

### **Ключевые компоненты**
- **context.py** - единый объект состояния (САМОЕ ВАЖНОЕ)
- **parser.py** - простой парсер ключевых слов
- **assumptions.py** - двигатель предположений ("магия ИИ")
- **human_recommendations.py** - понятные советы для оператора
- **handler.py** - главный обработчик сообщений
- **telegram_bot.py** - минимальная обертка для Telegram

### **Принципы**
- Один источник истины (контекст)
- Предположения вместо лишних вопросов
- Человечный язык общения
- Постепенное уточнение
- 
cnc-assistant/
│
├── app/
│   ├── main.py
│   ├── router.py
│
│   ├── data/
│   │   ├── cnc.db
│   │   └── db.sqlite
│
│   ├── dialog/
│   │   ├── flow.py          # FSM диалога (РАСШИРЕН)
│   │   ├── intents.py       # интенты + confidence hints
│   │   ├── slots.py         # слоты + source (user/system)
│   │   └── validators.py   # ✅ НОВОЕ (проверка адекватности данных)
│
│   ├── domain/
│   │   ├── machines.py      # станки + ограничения
│   │   ├── materials.py     # материалы
│   │   ├── operations.py   # операции
│   │   └── tools.py         # ✅ НОВОЕ (инструмент)
│
│   ├── logic/
│   │   ├── questions.py     # вопросы пользователю
│   │   ├── recommend.py    # рекомендации
│   │   └── evaluate.py     # ✅ НОВОЕ (оценка данных, не человека)
│
│   ├── memory/
│   │   ├── session.py       # текущее состояние
│   │   ├── history.py       # история диалогов
│   │   ├── profiles.py     # ✅ НОВОЕ (агрегированный профиль)
│   │   └── data/
│   │       └── db.sqlite
│
│   ├── storage/
│   │   ├── sqlite.py
│   │   └── models.py        # ✅ НОВОЕ (таблицы)
│
│   ├── analytics/           # ✅ НОВОЕ (очень важно)
│   │   ├── experience.py    # коэффициенты
│   │   └── dataset.py       # формирование датасетов
│
│   └── config/
│       └── thresholds.py    # ✅ НОВОЕ (пороги адекватности)
│
├── .env
├── .env_example
├── ARCHITECTURE.md
└── README.md

