# ARCHITECTURE.md

## Архитектура Системы «СТАНКО-ИИ» (День 1)

### **Цель дня**
К концу дня бот должен:
✅ выглядеть как ИИ
✅ не зацикливаться на вопросах  
✅ понимать контекст
✅ уметь делать предположения
✅ работать стабильно

❌ Без расчётов
❌ Без LLM
✅ Только логика

### **Поток данных**
1. Telegram сообщение → парсер → контекст → предположения → ответ

### **Ключевые компоненты**
- **context.py** - единый объект состояния (САМОЕ ВАЖНОЕ)
- **parser.py** - простой парсер ключевых слов
- **assumptions.py** - двигатель предположений ("магия ИИ")
- **human_recommendations.py** - понятные советы для оператора
- **handler.py** - главный обработчик сообщений
- **telegram_bot.py** - минимальная обертка для Telegram

### **Принципы**
- Один источник истины (контекст)
- Предположения вместо лишних вопросов
- Человечный язык общения
- Постепенное уточнение
- 
cnc-assistant/
├── app/
│   ├── main.py
│   │
│   ├── bot/
│   │   ├── telegram_bot.py    # Теперь с кнопками выбора
│   │   ├── cli_bot.py
│   │   └── dialogs.py         # Новый: диалоги с выбором (ниже/так же/выше)
│   │
│   ├── core/
│   │   ├── state_machine.py   # FSM для сбора данных
│   │   ├── calculator.py      # НОВЫЙ: расчет ограничений (мощность, геометрия)
│   │   ├── pass_strategy.py   # НОВЫЙ: разбивка на проходы (чернов/получист/чист)
│   │   └── validator.py       # Проверка физических ограничений
│   │
│   ├── domain/
│   │   ├── models.py          # Единая модель данных (как в вашем JSON)
│   │   └── experience.py      # Новый расчет коэффициента опыта
│   │
│   ├── services/
│   │   ├── recommendation.py  # Только БАЗОВЫЕ рекомендации (по таблицам)
│   │   ├── comparison.py      # НОВЫЙ: сравнение bot vs user
│   │   └── data_collector.py  # НОВЫЙ: сохранение решений оператора
│   │
│   └── storage/
│       ├── db.py
│       ├── models.py          # Обновленная схема под новую JSON-структуру
│       └── data_pipeline.py   # НОВЫЙ: подготовка данных для ИИ
│
├── data/
│   ├── rules/
│   │   └── cutting_modes.yaml # Только справочные значения
│   └── limits/
│       ├── machine_limits.yaml # Макс. ap по станкам
│       └── tool_limits.yaml    # Макс. ap по инструментам
│
└── requirements.txt


